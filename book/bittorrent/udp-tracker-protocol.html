<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>UDP Tracker Protocol - Intermodal</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Intermodal</a></li><li class="chapter-item expanded "><a href="../faq.html"><strong aria-hidden="true">1.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="../commands.html"><strong aria-hidden="true">2.</strong> Commands</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../commands/imdl.html"><strong aria-hidden="true">2.1.</strong> imdl</a></li><li class="chapter-item expanded "><a href="../commands/imdl-completions.html"><strong aria-hidden="true">2.2.</strong> imdl completions</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent.html"><strong aria-hidden="true">2.3.</strong> imdl torrent</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-create.html"><strong aria-hidden="true">2.4.</strong> imdl torrent create</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-link.html"><strong aria-hidden="true">2.5.</strong> imdl torrent link</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-piece-length.html"><strong aria-hidden="true">2.6.</strong> imdl torrent piece-length</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-show.html"><strong aria-hidden="true">2.7.</strong> imdl torrent show</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-stats.html"><strong aria-hidden="true">2.8.</strong> imdl torrent stats</a></li><li class="chapter-item expanded "><a href="../commands/imdl-torrent-verify.html"><strong aria-hidden="true">2.9.</strong> imdl torrent verify</a></li></ol></li><li class="chapter-item expanded "><a href="../bittorrent.html"><strong aria-hidden="true">3.</strong> Bittorrent</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../bittorrent/piece-length-selection.html"><strong aria-hidden="true">3.1.</strong> Piece Length Selection</a></li><li class="chapter-item expanded "><a href="../bittorrent/bep-support.html"><strong aria-hidden="true">3.2.</strong> BEP Support</a></li><li class="chapter-item expanded "><a href="../bittorrent/metainfo-utilities.html"><strong aria-hidden="true">3.3.</strong> Metainfo Utilities</a></li><li class="chapter-item expanded "><a href="../bittorrent/distributing-large-data-sets.html"><strong aria-hidden="true">3.4.</strong> Distributing Large Data Sets</a></li><li class="chapter-item expanded "><a href="../bittorrent/udp-tracker-protocol.html" class="active"><strong aria-hidden="true">3.5.</strong> UDP Tracker Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="../references.html"><strong aria-hidden="true">4.</strong> References</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../references/bittorrent.html"><strong aria-hidden="true">4.1.</strong> BitTorrent</a></li><li class="chapter-item expanded "><a href="../references/metadata.html"><strong aria-hidden="true">4.2.</strong> Metadata</a></li><li class="chapter-item expanded "><a href="../references/cryptography.html"><strong aria-hidden="true">4.3.</strong> Cryptography</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Intermodal</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/casey/intermodal" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="udp-tracker-protocol"><a class="header" href="#udp-tracker-protocol">UDP Tracker Protocol</a></h1>
<p>This description of the UDP tracker protocol is adapted from
<a href="https://libtorrent.org/udp_tracker_protocol.html">this page</a> by Arvid Norberg.</p>
<p>A tracker with the protocol “udp://” in its URI is should be contacted with
this protocol.</p>
<p>All values are sent in network byte order (big-endian).</p>
<p>If no response to a request is received within 15 seconds, resend the request.
If no reply has been received after 60 seconds, stop retrying.</p>
<p>Transaction IDs sent in request messages are returned in response messages.</p>
<p>Connection ID returned by tracker in connect response message should be sent
by client in later requests. The initial connection ID sent in connect requests
shoudl be <code>0x41727101980</code> in network byte order.</p>
<p>Action values in requests and responses should be taken from the <code>Actions</code>
table.</p>
<p>When a message is followed by a structure labeled <em>repeating:</em>, the rest of the
message is zero or more of that structure.</p>
<p>Fields with type <code>[T; N]</code> are <code>N</code> instances of values of type <code>T</code> with no extra
padding.</p>
<p>Fields with type <code>[T; NAME]</code> are <code>NAME</code> instances of values of type <code>T</code> with no
extra padding, where <code>NAME</code> is an integer field of the same message.</p>
<p>Files with type <code>[T]</code> are zero or more instances of values of type <code>T</code> with no
extra padding, which make up any trailing bytes of the message.</p>
<h2 id="actions"><a class="header" href="#actions">Actions</a></h2>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>value</th></tr></thead><tbody>
<tr><td>connect</td><td>0</td></tr>
<tr><td>announce</td><td>1</td></tr>
<tr><td>scrape</td><td>2</td></tr>
<tr><td>error</td><td>3</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>value</th></tr></thead><tbody>
<tr><td>none</td><td>0</td></tr>
<tr><td>completed</td><td>1</td></tr>
<tr><td>started</td><td>2</td></tr>
<tr><td>stopped</td><td>3</td></tr>
</tbody></table>
</div>
<h2 id="error"><a class="header" href="#error">Error</a></h2>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>i32</td><td>action</td><td></td></tr>
<tr><td>i32</td><td>transaction_id</td><td></td></tr>
<tr><td>[i8]</td><td>error_string</td><td>rest of packet is string describing error</td></tr>
</tbody></table>
</div>
<h2 id="connect"><a class="header" href="#connect">Connect</a></h2>
<h3 id="request"><a class="header" href="#request">Request</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i64</td><td>connection_id</td></tr>
<tr><td>i32</td><td>action</td></tr>
<tr><td>i32</td><td>transaction_id</td></tr>
</tbody></table>
</div>
<h3 id="response"><a class="header" href="#response">Response</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i32</td><td>action</td></tr>
<tr><td>i32</td><td>transaction_id</td></tr>
<tr><td>i64</td><td>connection_id</td></tr>
</tbody></table>
</div>
<h2 id="announce"><a class="header" href="#announce">Announce</a></h2>
<h3 id="request-1"><a class="header" href="#request-1">Request</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>i64</td><td>connection_id</td><td></td></tr>
<tr><td>i32</td><td>action</td><td></td></tr>
<tr><td>i32</td><td>transaction_id</td><td></td></tr>
<tr><td>[i8; 20]</td><td>info_hash</td><td>torrent infohash</td></tr>
<tr><td>[i8; 20]</td><td>peer_id</td><td>peer ID</td></tr>
<tr><td>i64</td><td>downloaded</td><td>bytes downloaded this session</td></tr>
<tr><td>i64</td><td>left</td><td>bytes left to download</td></tr>
<tr><td>i64</td><td>uploaded</td><td>bytes uploaded this session</td></tr>
<tr><td>i32</td><td>event</td><td>from <code>Events</code> table</td></tr>
<tr><td>u32</td><td>ip</td><td>0 to use sender of this UDP packet</td></tr>
<tr><td>u32</td><td>key</td><td>randomly generated by client, unknown function.</td></tr>
<tr><td>i32</td><td>num_want</td><td>maximum number of peers to send in reply, use -1 for default</td></tr>
<tr><td>u16</td><td>port</td><td>listening port</td></tr>
<tr><td>u16</td><td>extensions</td><td></td></tr>
</tbody></table>
</div>
<h3 id="response-1"><a class="header" href="#response-1">Response</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>i32</td><td>action</td><td></td></tr>
<tr><td>i32</td><td>transaction_id</td><td></td></tr>
<tr><td>i32</td><td>interval</td><td>seconds to wait announcing again</td></tr>
<tr><td>i32</td><td>leechers</td><td>number of peers in swarm that have not finished downloading</td></tr>
<tr><td>i32</td><td>seeders</td><td>number of peers in swarm that have finished downloading</td></tr>
</tbody></table>
</div>
<p><em>repeating:</em></p>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>i32</td><td>ip</td><td>peer IP</td></tr>
<tr><td>i16</td><td>port</td><td>peer listening port</td></tr>
</tbody></table>
</div>
<h2 id="scrape"><a class="header" href="#scrape">Scrape</a></h2>
<h3 id="request-2"><a class="header" href="#request-2">Request</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i64</td><td>connection_id</td></tr>
<tr><td>i32</td><td>action</td></tr>
<tr><td>i32</td><td>transaction_id</td></tr>
</tbody></table>
</div>
<p><em>repeating:</em></p>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>[i8; 20]</td><td>info_hash</td></tr>
</tbody></table>
</div>
<h3 id="response-2"><a class="header" href="#response-2">Response</a></h3>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i32</td><td>action</td></tr>
<tr><td>i32</td><td>transaction_id</td></tr>
</tbody></table>
</div>
<p><em>repeating:</em></p>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td>i32</td><td>complete</td><td>peers in swarm that have finished downloding</td></tr>
<tr><td>i32</td><td>downloaded</td><td>times torrent has been downloaded</td></tr>
<tr><td>i32</td><td>incomplete</td><td>peers that have not finished downloading</td></tr>
</tbody></table>
</div>
<h2 id="extensions"><a class="header" href="#extensions">Extensions</a></h2>
<p>The extensions field is a bitmask. The following bits are assigned:</p>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>bit</th></tr></thead><tbody>
<tr><td>authentication</td><td>1</td></tr>
<tr><td>request string</td><td>2</td></tr>
</tbody></table>
</div>
<p>If multiple bits are present in the extension field, the extension bodies are
appended to the packet in the order of least significant bit first. For
instance, if both bit 1 and 2 are set, the extension represented by bit 1 comes
first, followed by the extension represented by bit 2.</p>
<h3 id="authentication"><a class="header" href="#authentication">Authentication</a></h3>
<p>The packet will have authentication information appended to it.</p>
<p><code>passwd_hash</code> is the first eight bytes of <code>sha1(packet || sha1(password))</code>,
where <code>packet</code> is the bytes of the packet, less the final 8 bytes that are
<code>passwd_hash</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i8</td><td>username_length</td></tr>
<tr><td>[i8; <code>username_length</code></td><td>username</td></tr>
<tr><td>[u8; 8]</td><td>passwd_hash</td></tr>
</tbody></table>
</div>
<h3 id="request-string"><a class="header" href="#request-string">Request String</a></h3>
<p>The request string extension is meant to allow torrent creators pass along
cookies back to the tracker. This can be useful for authenticating that a
torrent is allowed to be tracked by a tracker for instance. It could also be
used to authenticate users by generating torrents with unique tokens in the
tracker URL for each user. The extension body has the following format:</p>
<div class="table-wrapper"><table><thead><tr><th>type</th><th>name</th></tr></thead><tbody>
<tr><td>i8</td><td>request_length</td></tr>
<tr><td>[i8; <code>request_length</code>]</td><td>request_string</td></tr>
</tbody></table>
</div>
<p><code>request_string</code> is the string that comes after the hostname and port in the
UDP tracker URL. Typically this starts with “/announce” The bittorrent client
is not expected to append query string arguments for stats reporting, like
“uploaded” and “downloaded” since this is already reported in the UDP tracker
protocol. However, the client is free to add arguments as extensions.|</p>
<h2 id="credits"><a class="header" href="#credits">Credits</a></h2>
<p>Protocol designed by Olaf van der Spek and extended by Arvid Norberg</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../bittorrent/distributing-large-data-sets.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../references.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../bittorrent/distributing-large-data-sets.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../references.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
